---
layout: topic
title: Introduction to dplyr
minutes: 45
---

```{r, echo=FALSE, purl=FALSE}
knitr::opts_chunk$set(results='hide', fig.path='img/r-lesson-')
```

> ## Learning Objectives
>
> * Familiarize participants with dplyr package
> * Understand the data manipulation verbs used in dplyr
> * Understand the concept of piping

## dplyr

[`dplyr`](https://github.com/hadley/dplyr) package offers simple, clear and 
efficient way of working with your data. Repeating from the package
[vignette](https://github.com/hadley/dplyr/blob/master/vignettes/introduction.Rmd):

When working with data you must:

* Figure out what you want to do.
* Precisely describe what you want in the form of a computer program.
* Execute the code.

The `dplyr` package makes each of these steps as fast and easy as possible by:

* Elucidating the most common data manipulation operations, so that your
  options are helpfully constrained when thinking about how to tackle a
  problem.
* Providing simple functions that correspond to the most common
  data manipulation verbs, so that you can easily translate your thoughts
  into code.
* Using efficient data storage backends, so that you spend as little time
  waiting for the computer as possible.
  
## Working with dplyr and the mammals data

```{r, echo=FALSE, purl=TRUE}
### Working with dplyr and the mammals data
```

Let's start exploring the capabilities of `dplyr` by looking at the basic single
table data manipulation verbs:

* `filter()` (and `slice()`)
* `arrange()`
* `select()` (and `rename()`)
* `distinct()`
* `mutate()` (and `transmute()`)
* `summarise()`
* `sample_n()` and `sample_frac()`

Let's look at each of these using the mammals data. First, let's load the data:

```{r, purl=FALSE}
surveys <- read.csv('data/surveys.csv')
head(surveys)
```

## Filter rows with `filter()`

```{r, echo=FALSE, purl=TRUE}
### Filter rows with `filter()`
```

`filter()` allows you to select a subset of the rows of a data frame. The first 
argument is the name of the data frame, and the second and subsequent are 
filtering expressions evaluated in the context of that data frame:

For example, using the `surveys` data we can select all observations for females 
of the North American Deermouse ([*Peromyscus maniculatus*](https://en.wikipedia.org/wiki/Peromyscus_maniculatus), see 
`"data/species.csv"` for the species information) made in January with:

```{r, message=FALSE, results='show', purl=FALSE}
# Start by loading dplyr
library(dplyr)
filter(surveys, month == 1, species_id == "PM", sex == "F")
```

This is equivalent to the more conventional and verbose:

```{r, eval = FALSE, purl=FALSE}
surveys[surveys$month == 1 & surveys$species_id == "PM", surveys$sex == "F", ]
```

`filter()` works similarly to `subset()` except that you can give it any number 
of filtering conditions which are joined together with `&` (not `&&` which is 
easy to do accidentally!).  You can use other boolean operators explicitly:

```{r, eval = FALSE, purl=FALSE}
filter(surveys, month == 1 | month == 2)
```

To select rows by position, use `slice()`:

```{r, results='show', purl=FALSE}
slice(surveys, 1:10)
```

